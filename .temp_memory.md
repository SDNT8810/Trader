# Project Memory

## Current State
- Project: Forex Gold Trading Bot
- Status: Training Phase
- Last Update: Training script optimization and model architecture improvements

## Recent Changes
1. Model Architecture Updates:
   - Increased hidden layer sizes: [1024, 512, 256, 128, 64]
   - Changed activation to leaky_relu
   - Updated weight initialization to kaiming
   - Increased dropout to 0.3
   - Added batch normalization
   - Reduced batch size to 128
   - Reduced learning rate to 0.0005
   - Changed loss function to huber
   - Increased epochs to 2000
   - Adjusted early stopping parameters
   - Changed learning rate scheduler to CosineAnnealingWarmRestarts
   - Reduced L2 regularization to 0.0001

2. Training Script Improvements:
   - Added better error handling for model loading
   - Added model architecture compatibility checks
   - Improved checkpoint loading with shape verification
   - Added warning messages for incompatible checkpoints
   - Enhanced progress reporting

3. Data Processing:
   - Input shape: [60, 43] (60 time steps, 43 features)
   - Output shape: [11] (11 output features)
   - Normalization enabled
   - Train/Val/Test split: 80/10/10

## Next Steps
1. Monitor training progress
2. Evaluate model performance
3. Fine-tune hyperparameters if needed
4. Implement additional optimizations if required

## Notes
- Model is currently being trained with improved architecture
- Training progress is being monitored with enhanced visualization
- Checkpoint system has been improved for better reliability
- Memory usage and performance are being tracked

## Project Memory File

## Current Project State
- Project is in rewrite phase
- New branch created for rewrite
- Original structure maintained but files are being rewritten
- Main focus: Forex Gold Trading Bot
- Data preprocessing and normalization modules completed
- Both modules support configuration via config.yaml
- Both modules have default values for all parameters
- Added 10 new technical indicators
- Model successfully tested with both default and custom configurations
- Basic visualization tools implemented
- Updated normalization strategy to handle price data differently
- Added volume to normalized indicators
- Separated time data from normalized data
- Updated visualization tools to handle new data structure
- Modified data normalizer to calculate differentials for specific indicators
- Added price differences to normalized data
- Implemented differential calculations for price data and selected indicators
- Created cost function module for price change calculations
- Implemented supervised learning training module for ANN
- Optimized training performance with parallel processing
- Added CPU core utilization for data loading and processing
- Implemented memory pinning and prefetching for faster data transfer
- Added non-blocking data transfers to GPU
- Enabled cuDNN benchmarking for faster training

## Project Structure
```
.
├── config/            # Configuration files
│   └── config.yaml   # Main configuration file (optional)
├── src/
│   ├── data/         # Data processing and management
│   │   ├── __init__.py
│   │   ├── data_preprocessor.py    # Data preprocessing with technical indicators
│   │   ├── data_normalizer.py      # Data normalization with configurable methods
│   │   ├── cost_function.py        # Calculate price changes and cumulative sum
│   │   └── check_data.py          # Data quality verification
│   ├── models/       # Trading models and strategies
│   │   ├── __init__.py
│   │   ├── trading_model.py       # ANN model implementation
│   │   └── model_utils.py         # Model utilities
│   ├── utils/        # Utility functions
│   ├── visualization/# Plotting and visualization tools
│   │   ├── visualize_ann.py     # Basic ANN visualization
│   │   ├── visualize_3d_ann.py  # 3D Manifold visualization
│   │   ├── plot_raw_data.py     # Plot raw technical indicators
│   │   ├── plot_normalized_data.py  # Plot normalized technical indicators
│   │   └── plot_Output.py       # Plot cost function results
│   ├── Figs/        # Generated figures
│   │   ├── RawData/    # Raw data plots
│   │   ├── Normalized/ # Normalized data plots
│   │   └── Reward/     # Cost function plots
│   ├── main.py      # Entry point
│   └── train.py     # Training script
├── requirements.txt  # Project dependencies
└── README.md        # Project documentation
```

## Technical Indicators
1. Price Data
   - Open, High, Low, Close (differentials)
   - Price differences (high_low, close_open, high_open, low_open)
   - Volume

2. Ichimoku Cloud (H1)
   - Tenkan-sen (Conversion Line): 9 periods
   - Kijun-sen (Base Line): 26 periods
   - Senkou Span B: 52 periods
   - All indicators as differentials

3. MACD (H1)
   - Fast EMA: 12 periods
   - Slow EMA: 26 periods
   - Signal Line: 9 periods
   - Price: Close

4. Parabolic SAR (H1)
   - Step: 0.02
   - Maximum: 0.2
   - As differential

5. EMA indicators
   - EMA 50 (H1)
   - EMA 200 (H1)
   - Both as differentials

6. Bollinger Bands (H1)
   - Period: 20
   - Price: Close
   - All bands as differentials

7. RSI indicators
   - RSI 14 (H1)
   - RSI 28 (H1)

8. Stochastic indicators
   - %K: 14 periods
   - %D: 3 periods

9. CCI indicator
   - CCI 14 (H1)

10. MFI indicator
    - MFI 14 (H1)

11. ATR indicator
    - ATR 14 (H1)

12. ADX indicators
    - ADX 14 (H1)
    - +DI 14 (H1)
    - -DI 14 (H1)

13. Momentum indicators
    - MOM 10 (H1)
    - MOM 20 (H1)

14. ROC indicators
    - ROC 10 (H1)
    - ROC 20 (H1)

15. Williams %R indicator
    - WILLR 14 (H1)

## Dependencies
- Python 3.8+
- Core: pandas, numpy, TA-Lib
- Deep Learning: torch, tensorflow, keras
- Visualization: matplotlib, seaborn, plotly, graphviz, torchviz, manim
- Development: pytest, black, flake8
- Additional: yfinance, optuna, pyyaml
- Parallel Processing: multiprocessing, torch.multiprocessing

## Progress Tracking
### Latest Changes
- [2024-04-21] Created temporary memory file
- [2024-04-21] Initialized project structure documentation
- [2024-04-21] Started ANN model design with 5 hidden layers
- [2024-04-21] Added config.yaml for model parameters
- [2024-04-21] Modified trading_model.py to use config file
- [2024-04-21] Moved config.yaml to config/ directory
- [2024-04-21] Fixed weight initialization and tested model
- [2024-04-21] Created visualization tools for ANN model
- [2024-04-21] Implemented data preprocessing with config support
- [2024-04-21] Implemented data normalization with config support
- [2024-04-21] Added 10 new technical indicators
- [2024-04-21] Tested both modules with new indicators
- [2024-04-21] Updated visualization tools to be config-aware
- [2024-04-21] Updated normalization strategy for price data
- [2024-04-21] Added volume to normalized indicators
- [2024-04-21] Separated time data from normalized data
- [2024-04-21] Updated visualization tools to handle new data structure
- [2024-04-21] Modified data normalizer to calculate differentials for specific indicators
- [2024-04-21] Added price differences to normalized data
- [2024-04-21] Implemented differential calculations for price data and selected indicators
- [2024-04-21] Created cost function module for price change calculations
- [2024-04-21] Implemented supervised learning training module for ANN
- [2024-04-21] Optimized training performance with parallel processing
- [2024-04-21] Added CPU core utilization for data loading and processing
- [2024-04-21] Implemented memory pinning and prefetching for faster data transfer
- [2024-04-21] Added non-blocking data transfers to GPU
- [2024-04-21] Enabled cuDNN benchmarking for faster training

### Current Progress
- Project structure established
- Requirements defined
- Files ready for rewrite
- Original functionality documented in todo.md
- ANN model implemented with configurable parameters
- Configuration system added with default values
- Configuration file optional but supported
- Model successfully tested with both configurations
- Basic visualization tools implemented
- Data preprocessing and normalization modules completed
- Both modules tested and working with/without config
- Added 10 new technical indicators
- Visualization tools updated to be config-aware
- Updated normalization strategy for better price handling
- Added volume to normalized indicators
- Separated time data from normalized data
- Updated visualization tools to handle new data structure
- Modified data normalizer to handle differentials for specific indicators
- Added price differences to normalized data
- Implemented differential calculations for price data
- Created cost function module for price change calculations
- Implemented supervised learning training module for ANN
- Optimized training module for better performance
- Implemented parallel processing for data loading
- Added memory optimization techniques
- Improved GPU utilization

### Next Steps
1. Test training module with different window sizes
2. Implement model evaluation metrics
3. Add model saving/loading functionality
4. Update visualization tools for training results
5. Implement backtesting functionality
6. Add risk management module
7. Create trading strategy module
8. Further optimize training performance
9. Add distributed training support
10. Implement model checkpointing

## Notes
- Focus on one file at a time
- Follow user's specific requests
- Maintain code quality and documentation
- Keep track of changes in todo.md
- Configuration files are optional in config/ directory
- Model works with both default and custom configurations
- Model architecture is working as expected
- Using specific technical indicators for feature engineering
- Data preprocessing and normalization modules are configurable
- Both modules have default values for all parameters
- Visualization tools are now config-aware
- Price data handled differently in normalization
- Volume added to normalized indicators
- Time data separated from normalized data
- Visualization tools updated to handle new data structure
- Differential calculations implemented for specific indicators
- Price differences added to normalized data
- Cost function module created for price change calculations
- Training module optimized for better performance
- Using parallel processing for data loading
- Memory optimization techniques implemented
- GPU utilization improved with non-blocking transfers
- cuDNN benchmarking enabled for faster training

## File Status
- [ ] src/data/__init__.py
- [x] src/data/data_preprocessor.py
- [ ] src/data/check_data.py
- [x] src/data/cost_function.py
- [ ] src/models/__init__.py
- [x] src/models/trading_model.py
- [ ] src/models/model_utils.py
- [ ] src/models/model_evaluation.py
- [ ] src/utils/__init__.py
- [ ] src/utils/technical_indicators.py
- [ ] src/visualization/__init__.py
- [x] src/visualization/visualize_ann.py
- [WIP] src/visualization/visualize_3d_ann.py
- [x] src/visualization/plot_raw_data.py
- [x] src/visualization/plot_normalized_data.py
- [ ] src/visualization/plotter.py
- [ ] src/main.py
- [x] src/train.py
- [x] config/config.yaml (optional) 